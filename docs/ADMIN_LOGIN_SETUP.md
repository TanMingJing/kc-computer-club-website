# ç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿ - è®¾ç½®æŒ‡å—

## æ¦‚è¿°

ç”µè„‘ç¤¾å®˜ç½‘ç°åœ¨æ”¯æŒ**ç®¡ç†å‘˜ç™»å½•åŠŸèƒ½**ã€‚ç®¡ç†å‘˜ä½¿ç”¨**ç”¨æˆ·å + å¯†ç **æ–¹å¼ç™»å½•åå°ç®¡ç†ç³»ç»Ÿã€‚

---

## ğŸ” ç®¡ç†å‘˜ç™»å½•æµç¨‹

### 1. **åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·**

#### æ–¹å¼ Aï¼šé€šè¿‡ API ç«¯ç‚¹åˆ›å»º

```bash
# ä½¿ç”¨ curl åˆ›å»ºç®¡ç†å‘˜
curl -X POST http://localhost:3000/api/admin/seed \
  -H "Content-Type: application/json" \
  -d '{"password":"your_secure_password"}'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºæˆåŠŸ",
  "admin": {
    "id": "xxx",
    "username": "admin",
    "createdAt": "2025-01-09T..."
  },
  "credentials": {
    "username": "admin",
    "password": "your_secure_password"
  }
}
```

#### æ–¹å¼ Bï¼šåœ¨ Appwrite æ§åˆ¶å°æ‰‹åŠ¨åˆ›å»º

1. æ‰“å¼€ Appwrite æ§åˆ¶å°
2. è¿›å…¥ `admins` Collection
3. åˆ›å»ºæ–°æ–‡æ¡£ï¼Œå¡«å…¥ä»¥ä¸‹å­—æ®µï¼š
   - `username`: `admin`ï¼ˆæˆ–å…¶ä»–ç”¨æˆ·åï¼‰
   - `passwordHash`: ä½¿ç”¨ bcrypt å“ˆå¸Œçš„å¯†ç 
   - `isActive`: `true`
   - `createdAt`: å½“å‰æ—¶é—´

> **æ³¨æ„ï¼š** å¯†ç å¿…é¡»ä½¿ç”¨ bcrypt è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚å¯ä½¿ç”¨åœ¨çº¿å·¥å…·ï¼ˆå¦‚ bcrypt.onlineï¼‰ç”Ÿæˆå“ˆå¸Œå€¼ã€‚

---

### 2. **ç®¡ç†å‘˜ç™»å½•**

è®¿é—® `/admin/login` é¡µé¢ï¼š

- **ç”¨æˆ·å**ï¼š`admin`ï¼ˆæˆ–åˆ›å»ºæ—¶è®¾ç½®çš„ç”¨æˆ·åï¼‰
- **å¯†ç **ï¼šåˆ›å»ºæ—¶è®¾ç½®çš„å¯†ç 
- ç™»å½•åè‡ªåŠ¨è·³è½¬è‡³ `/admin`ï¼ˆç®¡ç†åå°é¦–é¡µï¼‰

---

## ğŸ”„ ç®¡ç†å‘˜è®¤è¯æ¶æ„

### åç«¯éªŒè¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥ç”¨æˆ·å+å¯†ç 
        â†“
å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ° adminLogin()
        â†“
æœåŠ¡å™¨æŸ¥è¯¢ admins Collection
        â†“
å¯¹æ¯”å¯†ç å“ˆå¸Œï¼ˆbcrypt.compareï¼‰
        â†“
å¯†ç æ­£ç¡® â†’ æ›´æ–° lastLogin â†’ è¿”å›ç”¨æˆ·ä¿¡æ¯
å¯†ç é”™è¯¯ â†’ æŠ›å‡ºé”™è¯¯ "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
        â†“
AuthContext å­˜å‚¨ç”¨æˆ·çŠ¶æ€
        â†“
é‡å®šå‘åˆ° /admin
```

### å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `src/services/auth.service.ts` | `adminLogin()` - ç®¡ç†å‘˜ç™»å½•æœåŠ¡ |
| `src/contexts/AuthContext.tsx` | ç®¡ç†å‘˜è®¤è¯çŠ¶æ€ç®¡ç† |
| `src/app/admin/login/page.tsx` | ç®¡ç†å‘˜ç™»å½•é¡µé¢ |
| `src/app/admin/page.tsx` | ç®¡ç†åå°ï¼ˆæœ‰è®¤è¯å®ˆå«ï¼‰ |
| `src/app/api/admin/seed/route.ts` | APIï¼šåˆ›å»º/æ£€æŸ¥ç®¡ç†å‘˜è´¦æˆ· |

---

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

âœ… **å¯†ç å“ˆå¸Œ**ï¼šä½¿ç”¨ bcryptjs è¿›è¡Œå¯†ç å“ˆå¸Œå­˜å‚¨  
âœ… **ä¼šè¯ç®¡ç†**ï¼šAppwrite æœåŠ¡å™¨ç«¯ä¼šè¯  
âœ… **è®¤è¯å®ˆå«**ï¼šæœªç™»å½•ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ  
âœ… **æœ€åç™»å½•æ—¶é—´**ï¼šæ¯æ¬¡ç™»å½•æ›´æ–° `lastLogin` å­—æ®µ  
âœ… **è´¦æˆ·æ¿€æ´»çŠ¶æ€**ï¼šç¦ç”¨çš„ç®¡ç†å‘˜æ— æ³•ç™»å½•  

---

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åˆ›å»ºåˆå§‹ç®¡ç†å‘˜

é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œï¼š

```bash
npm run dev
```

ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼š

```bash
curl -X POST http://localhost:3000/api/admin/seed \
  -H "Content-Type: application/json" \
  -d '{"password":"YourSecurePassword123"}'
```

### æ£€æŸ¥ç°æœ‰ç®¡ç†å‘˜

```bash
curl http://localhost:3000/api/admin/seed
```

å“åº”ï¼š
```json
{
  "adminExists": true,
  "adminCount": 1,
  "admins": [
    {
      "id": "xxx",
      "username": "admin",
      "isActive": true,
      "createdAt": "2025-01-09T...",
      "lastLogin": "2025-01-09T..."
    }
  ]
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

- [ ] åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼ˆä½¿ç”¨ä¸Šè¿° APIï¼‰
- [ ] è®¿é—® `/admin/login` ç™»å½•
- [ ] è¿›å…¥ `/admin` æŸ¥çœ‹ç®¡ç†åå°
- [ ] å‘å¸ƒå…¬å‘Šã€åˆ›å»ºæ´»åŠ¨ã€ç®¡ç†è¯„è®º

---

## â“ å¸¸è§é—®é¢˜

### Q: å¿˜è®°ç®¡ç†å‘˜å¯†ç æ€ä¹ˆåŠï¼Ÿ

**A:** ç›®å‰éœ€è¦åœ¨ Appwrite æ§åˆ¶å°ä¸­æ‰‹åŠ¨æ›´æ–° `passwordHash` å­—æ®µã€‚

**æ­¥éª¤ï¼š**
1. æ‰“å¼€ Appwrite æ§åˆ¶å°
2. è¿›å…¥ `admins` Collection
3. ç¼–è¾‘ç›¸åº”çš„ç®¡ç†å‘˜è®°å½•
4. ä½¿ç”¨ bcrypt ç”Ÿæˆæ–°å¯†ç å“ˆå¸Œ
5. æ›´æ–° `passwordHash` å­—æ®µ

### Q: å¯ä»¥åˆ›å»ºå¤šä¸ªç®¡ç†å‘˜å—ï¼Ÿ

**A:** å¯ä»¥ã€‚é€šè¿‡ä¿®æ”¹ API ç«¯ç‚¹æˆ–åœ¨ Appwrite æ§åˆ¶å°ä¸­æ‰‹åŠ¨åˆ›å»ºå¤šä¸ªç®¡ç†å‘˜è®°å½•ã€‚æ¯ä¸ªç®¡ç†å‘˜éƒ½éœ€è¦å”¯ä¸€çš„ `username`ã€‚

### Q: ç®¡ç†å‘˜ç™»å‡ºåä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

**A:** ä¼šè¯ä¼šè¢«åˆ é™¤ï¼Œç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚

---

## ğŸ“Š æ•°æ®åº“ Schema

### admins Collection

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `username` | string | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| `passwordHash` | string | bcrypt å“ˆå¸Œåçš„å¯†ç  |
| `isActive` | boolean | æ˜¯å¦æ¿€æ´» |
| `permissions` | string | æƒé™åˆ—è¡¨ï¼ˆJSONï¼‰ |
| `lastLogin` | datetime | æœ€åç™»å½•æ—¶é—´ |
| `userId` | string | å…³è”ç”¨æˆ· IDï¼ˆå¯é€‰ï¼‰ |
| `createdAt` | datetime | åˆ›å»ºæ—¶é—´ |

---

## ğŸ“š ç›¸å…³èµ„æº

- [Bcryptjs æ–‡æ¡£](https://www.npmjs.com/package/bcryptjs)
- [Appwrite æ–‡æ¡£](https://appwrite.io/docs)
- [Next.js è®¤è¯æœ€ä½³å®è·µ](https://nextjs.org/docs)
